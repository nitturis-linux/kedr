# This script specifies the commands to prepare everything necessary to 
# test LeakCheck and to clean up after the test is finished or if 
# the initialization fails.

# Mount debugfs 
on_load mkdir -p "@CMAKE_CURRENT_BINARY_DIR@/debugfs"
on_load mount debugfs -t debugfs "@CMAKE_CURRENT_BINARY_DIR@/debugfs"

# Provide a way to roll back in case of error
on_unload umount "@CMAKE_CURRENT_BINARY_DIR@/debugfs"

# Load payloads
payload @CMAKE_BINARY_DIR@/leak_check/core/kedr_leak_check.ko
payload @CMAKE_BINARY_DIR@/leak_check/common_mm/kedr_lc_common_mm.ko
