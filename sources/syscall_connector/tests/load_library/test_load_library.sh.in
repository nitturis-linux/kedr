#! /bin/sh

kmodule="@CMAKE_BINARY_DIR@/syscall_connector/kernel_part/kedr_syscall_connector.ko"
cprogram="@CMAKE_CURRENT_BINARY_DIR@/test_sc_load_library_use_library"

insmod $kmodule
if test $? -ne 0; then
    printf "Cannot insert module for test\n"
    exit 1
fi
$cprogram
if test $? -ne 0; then
    printf "Program failed to running, or error occures while it executed.\n"
    rmmod $kmodule
    exit 1
fi
rmmod $kmodule
if test $? -ne 0; then
    printf "Cannot remove module in test\n"
    exit 1
fi
