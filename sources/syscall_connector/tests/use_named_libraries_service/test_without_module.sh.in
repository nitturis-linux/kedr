#! /bin/sh
test_file="@CMAKE_CURRENT_BINARY_DIR@/user_part/test_use_named_libraries_service_test_program"
sc_module="@CMAKE_BINARY_DIR@/syscall_connector/kernel_part/syscall_connector.ko"

insmod $sc_module
if test $? -ne 0; then
    printf "Cannot load syscall_connector module for test.\n"
    exit 1
fi
$test_file
if test $? -eq 0; then
    printf "Test was successfully executed, but it shouldn't,.\n"
    printf "because module, which register named library, is not loaded.\n"
    rmmod $sc_module
    exit 1
fi
printf "It is OK, that test program was executed with failure.\n"
printf "It is because module, implemented library, used by test program, is not loaded.\n"
rmmod $sc_module
if test $? -ne 0; then
    printf "Failed to unload test module.\n"
    exit 1
fi

