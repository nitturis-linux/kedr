Структура репозиториев для проекта KEDR
---------------------------------------

При разработке системы KEDR рекомендуется использовать центральный сервер 
для т.н. "эталонных" ("pristine") репозиториев. Выпуск очередной версии 
системы производится только с использованием репозиториев с этого сервера.

При ночных сборках системы все необх. файлы тоже берутся оттуда.

У каждого разработчика - своя копия соотв. репозитория. Там, собственно, 
ведётся разработка конкретных блоков системы, делаются локальные commit'ы и 
пр. Время от времени код из таких локальных репозиториев разработчики 
merge'ат в "pristine" репозиторий.

Структура репозиториев на центральном сервере:

=======================================================================
kedr  # top-level каталог проекта KEDR
    |
    +- kedr-0.x  # всё, что касается KEDR версий 0.x
    |   |
    |   +- current # репозиторий для разрабатываемой сейчас версии системы
    |   |   |
    |   |   +- devel-docs # различная документация для разработчиков
    |   |   +- sources # исходные коды всех компонентов системы, 
    |   |   |   |      # тесты, 
    |   |   |   |      # системы сборки и установки,
    |   |   |   |      # документация для пользователей и пр.
    |   |   |   |
    |   |   |   +- <component1>
    |   |   |   +- <component2>
    |   |   |   |
    |   |   |  ...
    |   |   |
    |   |   +- snippets # прототипы и разл. примеры кода
    |   |   +- other # то, что никуда больше не попало
    |   |
    |   +- kedr-0.1 # репозиторий для версии 0.1
    |   |   |
    |   |   +- devel-docs
    |   |   +- sources
    |   |   +- snippets
    |   |   +- other
    |   |
    |   +- kedr-0.2 # репозиторий для версии 0.2
    |   +- kedr-0.3 # репозиторий для версии 0.3
    |   |
    |   ...
    |
    +- kedr-1.x  # всё, что касается KEDR версий 1.x
    |   |
   ... ...
=======================================================================

Примечания
----------

В файлах .readme в разделах (подкаталогах) devel-docs, sources и т.д. 
каждого репозитория - более подробная информация о назначении соотв. 
раздела и о том, что и как в нём должно храниться.
=======================================================================

На данный момент рristine репозитории для KEDR организованы на сервере 
itgdev.

Для доступа извне (в т.ч. для clone и для работы через web-интерфейс) 
необходимо использовать след. базовый URL:
https://itgdev/hgwebdir.cgi/kedr/

Пример. Создание копии репозитория для очередной 0.x-версии системы:
    hg clone https://itgdev/hgwebdir.cgi/kedr/kedr-0.x/current/ kedr-current

Копия будет создана в подкаталоге kedr-current текущего каталога на 
локальной машине.

Для доступа изнутри (т.е. на самом сервере itgdev) стоит использовать след. 
путь к репозиториям:
d:\hg_repo\kedr\

Пример. Создание pristine репозитория для поддержки версии 0.2 после её 
выпуска:
    hg clone -r v0.2 d:\hg_repo\kedr\kedr-0.x\current kedr-0.2

Это понадобится при создании pristine репозиториев для maintenance 
выпущенных версий системы (см. ниже). 
=======================================================================

Разработка очередной версии системы ведётся, в основном, с использованием 
репозитория 'current'.

После выпуска очередной версии системы, maintainer данной ветви системы 
должен установить в репозитории 'current' tag на соотв. changeset (команда: 
hg tag, детали: hg help tag). 

Затем на центральном сервере необходимо создать отдельный репозиторий для 
дальнейшей поддержки (maintenance) данной версии системы: туда будут идти, 
например, backported bug fixes и пр. 

Пример. 
Пусть выскается версия 0.2 системы KEDR. Если эта версия системы проходит 
все необх. тесты, maintainer отмечает соотв. revision tag'ом "v0.2":
    hg tag v0.2

Затем maintainer создаёт отдельный репозиторий 'kedr-0.2' для дальнейшей 
поддержки этой версии (bug fixes и пр.):
    cd d:\hg_repo\kedr\kedr-0.x\
    hg clone -r v0.2 current kedr-0.2

Разработка очередной версии системы будет всё также вестись в репозитории 
'current', а maintenance-изменения (в основном, bug fixes) в версии 0.2 
будут выполняться в репозитории 'kedr-0.2'.

Если в дальнейшем принимается решение о том, что, например, версия 0.2 
системы KEDR больше поддерживаться не будет, репозиторий 'kedr-0.2' может 
быть удалён maintainer'ом с центрального сервера.
=======================================================================

При копировании репозитория на центральном сервере (внутри) стоит проверить 
содержимое файла .hg/hgrc в нём. Там стоит, как минимум, указать имя и 
email maintainer'а этого репозитория. Иногда может потребоваться и 
разрешить push в этот репозиторий для внешних пользователей (по умолчанию 
это запрещено.)

Пример файла .hg/hgrc:

######################################################
# Settings for this particular Mercurial repository

[web]
# Describe the repository and specify who maintains it
description = KEDR system v.0.10
contact = Maintainer's Name <some_address@ispras.ru>

# Allow everyone to push to this repository
allow_push = *

# Enable snapshot downloads
allow_archive = bz2 zip
######################################################
=======================================================================

